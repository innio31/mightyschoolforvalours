<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firestore Data Entry - Mighty School For Valours</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --color-primary: #1c3877;
            --color-primary-dark: #152a5f;
            --color-primary-light: #d1e0ff;
            --color-secondary: #e23639;
            --color-secondary-dark: #c21f22;
            --color-dark: #0f1f3d;
            --color-text: #333333;
            --color-background: #f8f9fa;
            --color-light-gray: #e9ecef;
            --color-white: #ffffff;
            --color-success: #22bb33;
            --color-warning: #f0ad4e;
            --color-info: #5bc0de;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: var(--color-text);
            background-color: var(--color-background);
            padding: 20px;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background-color: var(--color-white);
            border-radius: 8px;
            box-shadow: var(--shadow);
            padding: 20px;
        }

        h1 {
            color: var(--color-primary);
            text-align: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--color-primary-light);
        }

        h2 {
            color: var(--color-primary);
            margin: 25px 0 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--color-light-gray);
        }

        .tabs {
            display: flex;
            flex-wrap: wrap;
            margin-bottom: 20px;
            border-bottom: 1px solid var(--color-light-gray);
        }

        .tab {
            padding: 10px 20px;
            cursor: pointer;
            background-color: var(--color-light-gray);
            margin-right: 5px;
            border-radius: 5px 5px 0 0;
            transition: var(--transition);
        }

        .tab.active {
            background-color: var(--color-primary);
            color: var(--color-white);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: var(--color-dark);
        }

        .form-input,
        .form-select,
        .form-textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--color-light-gray);
            border-radius: 4px;
            font-family: inherit;
            font-size: 1rem;
            transition: var(--transition);
        }

        .form-input:focus,
        .form-select:focus,
        .form-textarea:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px rgba(28, 56, 119, 0.1);
        }

        .form-textarea {
            min-height: 100px;
            resize: vertical;
        }

        .btn {
            display: inline-block;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            text-decoration: none;
            font-weight: 600;
            text-align: center;
            transition: var(--transition);
            margin-right: 10px;
            margin-top: 10px;
        }

        .btn-primary {
            background-color: var(--color-primary);
            color: var(--color-white);
        }

        .btn-primary:hover {
            background-color: var(--color-primary-dark);
        }

        .btn-secondary {
            background-color: var(--color-secondary);
            color: var(--color-white);
        }

        .btn-secondary:hover {
            background-color: var(--color-secondary-dark);
        }

        .alert {
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
            display: none;
        }

        .alert-success {
            background-color: #e8f5e9;
            color: #2e7d32;
            border: 1px solid #a5d6a7;
        }

        .alert-error {
            background-color: #ffebee;
            color: #c62828;
            border: 1px solid #ef9a9a;
        }

        .array-field {
            margin-bottom: 15px;
        }

        .array-item {
            display: flex;
            margin-bottom: 10px;
        }

        .array-item input {
            flex: 1;
            margin-right: 10px;
        }

        .remove-item {
            background-color: var(--color-secondary);
            color: white;
            border: none;
            border-radius: 4px;
            width: 40px;
            cursor: pointer;
        }

        .add-item {
            background-color: var(--color-primary);
            color: white;
            border: none;
            border-radius: 4px;
            padding: 5px 10px;
            cursor: pointer;
            margin-bottom: 15px;
        }

        .firebase-config {
            background-color: var(--color-light-gray);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
        }

        .instructions {
            background-color: #e6f7ff;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid var(--color-info);
        }

        .instructions h3 {
            color: var(--color-info);
            margin-bottom: 10px;
        }

        .instructions ol {
            margin-left: 20px;
        }

        .instructions li {
            margin-bottom: 10px;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>Firestore Data Entry Interface</h1>
        <p>Use this interface to add data to your Firestore database for Mighty School For Valours.</p>

        <div class="instructions">
            <h3>Setup Instructions:</h3>
            <ol>
                <li>Open your Firebase project in the <a href="https://console.firebase.google.com/"
                        target="_blank">Firebase Console</a></li>
                <li>Go to Project Settings > General > Your Apps</li>
                <li>Find your web app and copy the Firebase configuration</li>
                <li>Paste the configuration in the fields below</li>
                <li>Click "Initialize Firebase" to connect to your database</li>
            </ol>
        </div>

        <div class="firebase-config">
            <h2>Firebase Configuration</h2>
            <div class="form-group">
                <label class="form-label">API Key</label>
                <input type="text" id="apiKey" class="form-input" placeholder="Your Firebase API Key">
            </div>
            <div class="form-group">
                <label class="form-label">Auth Domain</label>
                <input type="text" id="authDomain" class="form-input" placeholder="your-project.firebaseapp.com">
            </div>
            <div class="form-group">
                <label class="form-label">Project ID</label>
                <input type="text" id="projectId" class="form-input" placeholder="your-project-id">
            </div>
            <div class="form-group">
                <label class="form-label">Storage Bucket</label>
                <input type="text" id="storageBucket" class="form-input" placeholder="your-project.appspot.com">
            </div>
            <div class="form-group">
                <label class="form-label">Messaging Sender ID</label>
                <input type="text" id="messagingSenderId" class="form-input" placeholder="1234567890">
            </div>
            <div class="form-group">
                <label class="form-label">App ID</label>
                <input type="text" id="appId" class="form-input" placeholder="your-app-id">
            </div>
            <button id="initializeFirebase" class="btn btn-primary">Initialize Firebase</button>
            <div id="configStatus" class="alert"></div>
        </div>

        <div id="databaseInterface" style="display: none;">
            <h2>Add Data to Collections</h2>

            <div class="tabs">
                <div class="tab active" data-tab="students">Students</div>
                <div class="tab" data-tab="staff">Staff</div>
                <div class="tab" data-tab="subjects">Subjects</div>
                <div class="tab" data-tab="classes">Classes</div>
                <div class="tab" data-tab="exams">Exams</div>
                <div class="tab" data-tab="questions">Questions</div>
                <div class="tab" data-tab="settings">Settings</div>
            </div>

            <!-- Students Form -->
            <div class="tab-content active" id="students-tab">
                <h2>Add Student</h2>
                <form id="studentForm">
                    <div class="form-group">
                        <label class="form-label">Admission Number*</label>
                        <input type="text" id="admissionNumber" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Full Name*</label>
                        <input type="text" id="studentFullName" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Email*</label>
                        <input type="email" id="studentEmail" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Class*</label>
                        <select id="studentClass" class="form-select" required>
                            <option value="">Select Class</option>
                            <option value="jss1">JSS 1</option>
                            <option value="jss2">JSS 2</option>
                            <option value="jss3">JSS 3</option>
                            <option value="ss1">SS 1</option>
                            <option value="ss2">SS 2</option>
                            <option value="ss3">SS 3</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Date of Birth</label>
                        <input type="date" id="studentDob" class="form-input">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Gender</label>
                        <select id="studentGender" class="form-select">
                            <option value="">Select Gender</option>
                            <option value="male">Male</option>
                            <option value="female">Female</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Parent Name</label>
                        <input type="text" id="parentName" class="form-input">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Parent Phone</label>
                        <input type="tel" id="parentPhone" class="form-input">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Address</label>
                        <textarea id="studentAddress" class="form-textarea"></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary">Add Student</button>
                </form>
                <div id="studentStatus" class="alert"></div>
            </div>

            <!-- Staff Form -->
            <div class="tab-content" id="staff-tab">
                <h2>Add Staff Member</h2>
                <form id="staffForm">
                    <div class="form-group">
                        <label class="form-label">Staff ID*</label>
                        <input type="text" id="staffId" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Full Name*</label>
                        <input type="text" id="staffFullName" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Email*</label>
                        <input type="email" id="staffEmail" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Role*</label>
                        <select id="staffRole" class="form-select" required>
                            <option value="">Select Role</option>
                            <option value="teacher">Teacher</option>
                            <option value="admin">Administrator</option>
                            <option value="bursar">Bursar</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Department</label>
                        <input type="text" id="staffDepartment" class="form-input">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Phone</label>
                        <input type="tel" id="staffPhone" class="form-input">
                    </div>
                    <button type="submit" class="btn btn-primary">Add Staff</button>
                </form>
                <div id="staffStatus" class="alert"></div>
            </div>

            <!-- Subjects Form -->
            <div class="tab-content" id="subjects-tab">
                <h2>Add Subject</h2>
                <form id="subjectForm">
                    <div class="form-group">
                        <label class="form-label">Subject Name*</label>
                        <input type="text" id="subjectName" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Subject Code*</label>
                        <input type="text" id="subjectCode" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Description</label>
                        <textarea id="subjectDescription" class="form-textarea"></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary">Add Subject</button>
                </form>
                <div id="subjectStatus" class="alert"></div>
            </div>

            <!-- Classes Form -->
            <div class="tab-content" id="classes-tab">
                <h2>Add Class</h2>
                <form id="classForm">
                    <div class="form-group">
                        <label class="form-label">Class Name*</label>
                        <input type="text" id="className" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Level*</label>
                        <select id="classLevel" class="form-select" required>
                            <option value="">Select Level</option>
                            <option value="jss">Junior Secondary (JSS)</option>
                            <option value="ss">Senior Secondary (SS)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Form Teacher</label>
                        <input type="text" id="formTeacher" class="form-input" placeholder="Staff ID of form teacher">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Students (comma-separated IDs)</label>
                        <textarea id="classStudents" class="form-textarea"
                            placeholder="Enter student IDs separated by commas"></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary">Add Class</button>
                </form>
                <div id="classStatus" class="alert"></div>
            </div>

            <!-- Exams Form -->
            <div class="tab-content" id="exams-tab">
                <h2>Add Exam</h2>
                <form id="examForm">
                    <div class="form-group">
                        <label class="form-label">Exam Title*</label>
                        <input type="text" id="examTitle" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Subject ID*</label>
                        <input type="text" id="examSubjectId" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Class ID*</label>
                        <input type="text" id="examClassId" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Exam Type*</label>
                        <select id="examType" class="form-select" required>
                            <option value="">Select Type</option>
                            <option value="practice">Practice</option>
                            <option value="actual">Actual Exam</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Duration (minutes)*</label>
                        <input type="number" id="examDuration" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Total Questions*</label>
                        <input type="number" id="examTotalQuestions" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Instructions</label>
                        <textarea id="examInstructions" class="form-textarea"></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Status*</label>
                        <select id="examStatus" class="form-select" required>
                            <option value="">Select Status</option>
                            <option value="draft">Draft</option>
                            <option value="active">Active</option>
                            <option value="completed">Completed</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Created By (Staff ID)*</label>
                        <input type="text" id="examCreatedBy" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Start Date</label>
                        <input type="datetime-local" id="examStartDate" class="form-input">
                    </div>
                    <div class="form-group">
                        <label class="form-label">End Date</label>
                        <input type="datetime-local" id="examEndDate" class="form-input">
                    </div>
                    <button type="submit" class="btn btn-primary">Add Exam</button>
                </form>
                <div id="examStatus" class="alert"></div>
            </div>

            <!-- Questions Form -->
            <div class="tab-content" id="questions-tab">
                <h2>Add Question</h2>
                <form id="questionForm">
                    <div class="form-group">
                        <label class="form-label">Exam ID*</label>
                        <input type="text" id="questionExamId" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Question Text*</label>
                        <textarea id="questionText" class="form-textarea" required></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Question Type*</label>
                        <select id="questionType" class="form-select" required>
                            <option value="">Select Type</option>
                            <option value="multiple_choice">Multiple Choice</option>
                            <option value="true_false">True/False</option>
                            <option value="short_answer">Short Answer</option>
                        </select>
                    </div>
                    <div id="optionsContainer" style="display: none;">
                        <label class="form-label">Options (for multiple choice)</label>
                        <div id="optionsList"></div>
                        <button type="button" id="addOption" class="add-item">Add Option</button>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Correct Answer*</label>
                        <input type="text" id="correctAnswer" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Marks*</label>
                        <input type="number" id="questionMarks" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Difficulty</label>
                        <select id="questionDifficulty" class="form-select">
                            <option value="">Select Difficulty</option>
                            <option value="easy">Easy</option>
                            <option value="medium">Medium</option>
                            <option value="hard">Hard</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Created By (Staff ID)*</label>
                        <input type="text" id="questionCreatedBy" class="form-input" required>
                    </div>
                    <button type="submit" class="btn btn-primary">Add Question</button>
                </form>
                <div id="questionStatus" class="alert"></div>
            </div>

            <!-- Settings Form -->
            <div class="tab-content" id="settings-tab">
                <h2>Update System Settings</h2>
                <form id="settingsForm">
                    <div class="form-group">
                        <label class="form-label">School Name*</label>
                        <input type="text" id="schoolName" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">School Logo URL</label>
                        <input type="url" id="schoolLogo" class="form-input">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Academic Term*</label>
                        <select id="academicTerm" class="form-select" required>
                            <option value="">Select Term</option>
                            <option value="first">First Term</option>
                            <option value="second">Second Term</option>
                            <option value="third">Third Term</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Academic Year*</label>
                        <input type="text" id="academicYear" class="form-input" required placeholder="2023/2024">
                    </div>
                    <fieldset>
                        <legend>CBT Settings</legend>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="practiceMode" checked> Enable Practice Mode
                            </label>
                        </div>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="examMode" checked> Enable Exam Mode
                            </label>
                        </div>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="timeLimit" checked> Enable Time Limit
                            </label>
                        </div>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="showResults" checked> Show Results Immediately
                            </label>
                        </div>
                    </fieldset>
                    <div class="form-group">
                        <label class="form-label">Updated By (Staff ID)*</label>
                        <input type="text" id="settingsUpdatedBy" class="form-input" required>
                    </div>
                    <button type="submit" class="btn btn-primary">Update Settings</button>
                </form>
                <div id="settingsStatus" class="alert"></div>
            </div>
        </div>
    </div>

    <!-- Firebase App (core Firebase SDK) -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <!-- Firebase Firestore -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <script>
        // Global variables
        let db = null;
        let firebaseInitialized = false;

        // DOM Elements
        const initializeFirebaseBtn = document.getElementById('initializeFirebase');
        const configStatus = document.getElementById('configStatus');
        const databaseInterface = document.getElementById('databaseInterface');
        const tabs = document.querySelectorAll('.tab');
        const tabContents = document.querySelectorAll('.tab-content');

        // Initialize Firebase
        initializeFirebaseBtn.addEventListener('click', () => {
            const apiKey = document.getElementById('apiKey').value;
            const authDomain = document.getElementById('authDomain').value;
            const projectId = document.getElementById('projectId').value;
            const storageBucket = document.getElementById('storageBucket').value;
            const messagingSenderId = document.getElementById('messagingSenderId').value;
            const appId = document.getElementById('appId').value;

            if (!apiKey || !authDomain || !projectId) {
                showAlert(configStatus, 'Please fill in all required fields', 'error');
                return;
            }

            try {
                // Firebase configuration
                const firebaseConfig = {
                    apiKey: apiKey,
                    authDomain: authDomain,
                    projectId: projectId,
                    storageBucket: storageBucket,
                    messagingSenderId: messagingSenderId,
                    appId: appId
                };

                // Initialize Firebase
                firebase.initializeApp(firebaseConfig);
                db = firebase.firestore();

                firebaseInitialized = true;
                showAlert(configStatus, 'Firebase initialized successfully! You can now add data to your collections.', 'success');
                databaseInterface.style.display = 'block';

            } catch (error) {
                showAlert(configStatus, 'Error initializing Firebase: ' + error.message, 'error');
                console.error('Firebase initialization error:', error);
            }
        });

        // Tab functionality
        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                const tabId = tab.getAttribute('data-tab');

                // Remove active class from all tabs and contents
                tabs.forEach(t => t.classList.remove('active'));
                tabContents.forEach(c => c.classList.remove('active'));

                // Add active class to clicked tab and corresponding content
                tab.classList.add('active');
                document.getElementById(`${tabId}-tab`).classList.add('active');
            });
        });

        // Question type change handler
        const questionType = document.getElementById('questionType');
        const optionsContainer = document.getElementById('optionsContainer');
        const optionsList = document.getElementById('optionsList');
        const addOptionBtn = document.getElementById('addOption');

        questionType.addEventListener('change', () => {
            if (questionType.value === 'multiple_choice') {
                optionsContainer.style.display = 'block';
                // Add first option field
                addOptionField();
            } else {
                optionsContainer.style.display = 'none';
                optionsList.innerHTML = '';
            }
        });

        // Add option field
        addOptionBtn.addEventListener('click', addOptionField);

        function addOptionField() {
            const optionDiv = document.createElement('div');
            optionDiv.className = 'array-item';
            optionDiv.innerHTML = `
                <input type="text" class="form-input option-input" placeholder="Option text">
                <button type="button" class="remove-item">&times;</button>
            `;
            optionsList.appendChild(optionDiv);

            // Add remove event listener
            const removeBtn = optionDiv.querySelector('.remove-item');
            removeBtn.addEventListener('click', () => {
                optionDiv.remove();
            });
        }

        // Form submission handlers
        document.getElementById('studentForm').addEventListener('submit', handleStudentSubmit);
        document.getElementById('staffForm').addEventListener('submit', handleStaffSubmit);
        document.getElementById('subjectForm').addEventListener('submit', handleSubjectSubmit);
        document.getElementById('classForm').addEventListener('submit', handleClassSubmit);
        document.getElementById('examForm').addEventListener('submit', handleExamSubmit);
        document.getElementById('questionForm').addEventListener('submit', handleQuestionSubmit);
        document.getElementById('settingsForm').addEventListener('submit', handleSettingsSubmit);

        // Form submission functions
        function handleStudentSubmit(e) {
            e.preventDefault();
            if (!firebaseInitialized) {
                showAlert('studentStatus', 'Please initialize Firebase first', 'error');
                return;
            }

            const studentData = {
                admissionNumber: document.getElementById('admissionNumber').value,
                fullName: document.getElementById('studentFullName').value,
                email: document.getElementById('studentEmail').value,
                class: document.getElementById('studentClass').value,
                dateOfBirth: document.getElementById('studentDob').value || null,
                gender: document.getElementById('studentGender').value || '',
                parentName: document.getElementById('parentName').value || '',
                parentPhone: document.getElementById('parentPhone').value || '',
                address: document.getElementById('studentAddress').value || '',
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
            };

            addDocument('students', studentData, 'studentStatus');
        }

        function handleStaffSubmit(e) {
            e.preventDefault();
            if (!firebaseInitialized) {
                showAlert('staffStatus', 'Please initialize Firebase first', 'error');
                return;
            }

            const staffData = {
                staffId: document.getElementById('staffId').value,
                fullName: document.getElementById('staffFullName').value,
                email: document.getElementById('staffEmail').value,
                role: document.getElementById('staffRole').value,
                department: document.getElementById('staffDepartment').value || '',
                phone: document.getElementById('staffPhone').value || '',
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
            };

            addDocument('staff', staffData, 'staffStatus');
        }

        function handleSubjectSubmit(e) {
            e.preventDefault();
            if (!firebaseInitialized) {
                showAlert('subjectStatus', 'Please initialize Firebase first', 'error');
                return;
            }

            const subjectData = {
                name: document.getElementById('subjectName').value,
                code: document.getElementById('subjectCode').value,
                description: document.getElementById('subjectDescription').value || '',
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
            };

            addDocument('subjects', subjectData, 'subjectStatus');
        }

        function handleClassSubmit(e) {
            e.preventDefault();
            if (!firebaseInitialized) {
                showAlert('classStatus', 'Please initialize Firebase first', 'error');
                return;
            }

            const studentsText = document.getElementById('classStudents').value;
            const studentsArray = studentsText ? studentsText.split(',').map(s => s.trim()) : [];

            const classData = {
                name: document.getElementById('className').value,
                level: document.getElementById('classLevel').value,
                formTeacher: document.getElementById('formTeacher').value || '',
                students: studentsArray,
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
            };

            addDocument('classes', classData, 'classStatus');
        }

        function handleExamSubmit(e) {
            e.preventDefault();
            if (!firebaseInitialized) {
                showAlert('examStatus', 'Please initialize Firebase first', 'error');
                return;
            }

            const examData = {
                title: document.getElementById('examTitle').value,
                subjectId: document.getElementById('examSubjectId').value,
                classId: document.getElementById('examClassId').value,
                type: document.getElementById('examType').value,
                duration: parseInt(document.getElementById('examDuration').value),
                totalQuestions: parseInt(document.getElementById('examTotalQuestions').value),
                instructions: document.getElementById('examInstructions').value || '',
                status: document.getElementById('examStatus').value,
                createdBy: document.getElementById('examCreatedBy').value,
                createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                startDate: document.getElementById('examStartDate').value ?
                    firebase.firestore.Timestamp.fromDate(new Date(document.getElementById('examStartDate').value)) : null,
                endDate: document.getElementById('examEndDate').value ?
                    firebase.firestore.Timestamp.fromDate(new Date(document.getElementById('examEndDate').value)) : null
            };

            addDocument('exams', examData, 'examStatus');
        }

        function handleQuestionSubmit(e) {
            e.preventDefault();
            if (!firebaseInitialized) {
                showAlert('questionStatus', 'Please initialize Firebase first', 'error');
                return;
            }

            // Get options for multiple choice questions
            let options = [];
            if (questionType.value === 'multiple_choice') {
                const optionInputs = document.querySelectorAll('.option-input');
                optionInputs.forEach(input => {
                    if (input.value.trim() !== '') {
                        options.push(input.value.trim());
                    }
                });
            }

            const questionData = {
                examId: document.getElementById('questionExamId').value,
                questionText: document.getElementById('questionText').value,
                questionType: document.getElementById('questionType').value,
                options: options,
                correctAnswer: document.getElementById('correctAnswer').value,
                marks: parseInt(document.getElementById('questionMarks').value),
                difficulty: document.getElementById('questionDifficulty').value || 'medium',
                createdBy: document.getElementById('questionCreatedBy').value,
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
            };

            addDocument('questions', questionData, 'questionStatus');
        }

        function handleSettingsSubmit(e) {
            e.preventDefault();
            if (!firebaseInitialized) {
                showAlert('settingsStatus', 'Please initialize Firebase first', 'error');
                return;
            }

            const settingsData = {
                schoolName: document.getElementById('schoolName').value,
                schoolLogo: document.getElementById('schoolLogo').value || '',
                academicTerm: document.getElementById('academicTerm').value,
                academicYear: document.getElementById('academicYear').value,
                cbtSettings: {
                    practiceMode: document.getElementById('practiceMode').checked,
                    examMode: document.getElementById('examMode').checked,
                    timeLimit: document.getElementById('timeLimit').checked,
                    showResults: document.getElementById('showResults').checked
                },
                updatedAt: firebase.firestore.FieldValue.serverTimestamp(),
                updatedBy: document.getElementById('settingsUpdatedBy').value
            };

            // For settings, we'll use a fixed document ID
            addDocument('settings', settingsData, 'settingsStatus', 'system_settings');
        }

        // Helper function to add document to Firestore
        function addDocument(collection, data, statusElementId, docId = null) {
            const statusElement = document.getElementById(statusElementId);

            let promise;
            if (docId) {
                // Use a specific document ID
                promise = db.collection(collection).doc(docId).set(data);
            } else {
                // Let Firestore auto-generate the ID
                promise = db.collection(collection).add(data);
            }

            promise
                .then((docRef) => {
                    const message = docId ?
                        `Document updated successfully in ${collection} collection!` :
                        `Document added successfully to ${collection} collection with ID: ${docRef.id}`;

                    showAlert(statusElement, message, 'success');

                    // Clear the form (except for settings)
                    if (collection !== 'settings') {
                        document.getElementById(`${collection}Form`).reset();
                    }
                })
                .catch((error) => {
                    showAlert(statusElement, 'Error adding document: ' + error.message, 'error');
                    console.error('Error adding document:', error);
                });
        }

        // Helper function to show alert messages
        function showAlert(element, message, type) {
            element.textContent = message;
            element.classList.remove('alert-success', 'alert-error');
            element.classList.add(type === 'success' ? 'alert-success' : 'alert-error');
            element.style.display = 'block';

            // Scroll to the alert
            element.scrollIntoView({ behavior: 'smooth', block: 'nearest' });

            // Hide alert after 5 seconds
            setTimeout(() => {
                element.style.display = 'none';
            }, 5000);
        }
    </script>
</body>

</html>